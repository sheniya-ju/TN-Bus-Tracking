<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Login â€” TN Bus Tracking</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>
body {
  font-family: "Poppins", sans-serif;
  background: radial-gradient(circle at top, #0a2e14, #031108);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  margin: 0;
  color: #d9fcd6;
}

/* Card container with glassmorphism effect */
.card {
  background: rgba(18, 40, 22, 0.85);
  padding: 30px;
  border-radius: 18px;
  width: 100%;
  max-width: 400px;
  box-shadow: 0 0 25px rgba(0, 255, 100, 0.25);
  text-align: center;
  backdrop-filter: blur(12px);
  border: 1px solid rgba(0, 255, 100, 0.2);
}

/* Logo styling */
.logo {
  width: 320px;
  height: auto;
  margin-bottom: 15px;
  filter: drop-shadow(0 0 15px #00ff80);
}

/* Headings */
h2 {
  color: #9effa4;
  text-shadow: 0 0 8px #00ff80;
  margin-bottom: 15px;
}

/* Inputs and dropdown */
input, select, button {
  width: 100%;
  padding: 12px;
  margin: 8px 0;
  border-radius: 10px;
  border: 1px solid #00b36b;
  background: rgba(0, 40, 20, 0.6);
  color: #d9fcd6;
  font-size: 1rem;
  outline: none;
  transition: all 0.2s ease-in-out;
}

input::placeholder {
  color: #9cdba4;
}

input:focus, select:focus {
  border-color: #00ff80;
  box-shadow: 0 0 10px #00ff80;
}

/* Button styles */
button {
  background: linear-gradient(90deg, #00ff80, #00cc66);
  color: #021808;
  font-weight: bold;
  border: none;
  cursor: pointer;
  transition: 0.3s ease;
  box-shadow: 0 0 12px #00ff80;
}

button:hover {
  background: linear-gradient(90deg, #00cc66, #00ff99);
  box-shadow: 0 0 20px #00ff99;
  transform: scale(1.03);
}

/* Error message */
.error {
  color: #ff6060;
  font-size: 0.9rem;
  text-align: center;
  margin-top: 8px;
}

/* Links */
a {
  color: #00ff99;
  text-decoration: none;
  font-weight: 500;
}
a:hover {
  text-decoration: underline;
  text-shadow: 0 0 6px #00ff80;
}

/* Glow animation (optional) */
@keyframes glow {
  0% { box-shadow: 0 0 5px #00ff80; }
  50% { box-shadow: 0 0 20px #00ff80; }
  100% { box-shadow: 0 0 5px #00ff80; }
}
</style>
</head>
<body>
<div class="card">
  <img src="../image.jpg" class="logo" alt="TN Bus Tracker Logo">
  <h2>Login</h2>
  <input id="email" type="email" placeholder="Email"/>
  <input id="password" type="password" placeholder="Password"/>
  <center>
    <select id="role">
      <option value="user">User</option>
      <option value="driver">Driver</option>
      <option value="admin">Admin</option>
    </select>
  </center>
  <button id="btnLogin">Login</button>
  <p class="error" id="loginError"></p>
  <p>Don't have account? <a href="signup.html">Signup</a></p>
</div>

<script type="module">
import { db, ref, get, keyFromEmail, auth, signInWithEmailAndPassword } from "./firebase.js";

const btnLogin = document.getElementById('btnLogin');
const loginError = document.getElementById('loginError');

btnLogin.addEventListener('click', async () => {
  loginError.textContent = '';
  const email = document.getElementById('email').value.trim().toLowerCase();
  const password = document.getElementById('password').value;
  const role = document.getElementById('role').value.toLowerCase();

  if(!email || !password){ 
    loginError.textContent = 'Enter email & password'; 
    return; 
  }

  try {
    const userCredential = await signInWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;

    const snap = await get(ref(db, `users/${keyFromEmail(email)}`));
    if(!snap.exists()){ 
      loginError.textContent = 'User not found'; 
      return; 
    }

    const userData = snap.val();
    if(userData.role !== role){ 
      loginError.textContent = 'Role mismatch'; 
      return; 
    }

    if(role === 'driver') window.location.href = 'driver.html';
    else if(role === 'admin') window.location.href = 'admin.html';
    else window.location.href = 'user.html';

  } catch(err) {
    loginError.textContent = err.message;
    console.error(err);
  }
});
</script>
</body>
</html>
