<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Login â€” TN Bus Tracking</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>
body{font-family:Arial,sans-serif;background:#e8f5e9;display:flex;justify-content:center;align-items:center;height:100vh;margin:0}
.card{background:#a5d6a7;padding:25px;border-radius:12px;width:100%;max-width:400px;box-shadow:0 4px 12px rgba(0,0,0,0.1)}
input,select,button{width:100%;padding:12px;margin:8px 0;border-radius:8px;border:1px solid #81c784}
button{background:#388e3c;color:white;font-weight:bold;cursor:pointer;border:none}
button:hover{background:#2e7d32}
.error{color:red;font-size:0.9rem;text-align:center}
</style>
</head>
<body>
<div class="card">
      <img src="../image.jpeg" class="logo">
<h2>Login</h2>
<input id="email" type="email" placeholder="Email"/>
<input id="password" type="password" placeholder="Password"/>
<select id="role">
  <option value="user">User</option>
  <option value="driver">Driver</option>
  <option value="admin">Admin</option>
</select>
<button id="btnLogin">Login</button>
<p class="error" id="loginError"></p>
<p>Don't have account? <a href="signup.html">Signup</a></p>
</div>

<script type="module">
import { db, ref, get, keyFromEmail, auth, signInWithEmailAndPassword, createSession } from "./firebase-config.js";

const btnLogin=document.getElementById('btnLogin');
const loginError=document.getElementById('loginError');

btnLogin.addEventListener('click', async () => {
  loginError.textContent = '';
  const email = document.getElementById('email').value.trim().toLowerCase();
  const password = document.getElementById('password').value;
  const role = document.getElementById('role').value.toLowerCase();

  if(!email || !password){ loginError.textContent='Enter email & password'; return; }

  try {
    const userCredential = await signInWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;

    const snap = await get(ref(db, `users/${keyFromEmail(email)}`));
    if(!snap.exists()){ loginError.textContent='User not found'; return; }

    const userData = snap.val();
    if(userData.role !== role){ loginError.textContent='Role mismatch'; return; }

    await createSession(user);

    if(role==='driver') window.location.href='driver.html';
    else if(role==='admin') window.location.href='admin.html';
    else window.location.href='user.html';

  } catch(e) {
    loginError.textContent = e.message;
    console.error(e);
  }
});
</script>
</body>
</html>
